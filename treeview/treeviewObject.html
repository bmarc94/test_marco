<html>
<head>

<SCRIPT>
/*******/
/*UTILS*/
/*******/
function createElementAndAppend(elTagName,parentEl){
	var el = document.createElement(elTagName);
	parentEl.appendChild(el);
	return el;
}

/************/
/* Treeview */
/************/


/*base*/
function BaseTreeView(targetId,data){
	this.treeViewWrapper = document.getElementById(targetId);
	this.treeViewWrapper.id = targetId;
	this.data = data;
	
	this.init = function(){
		for (var i in data){
			var item=this.createItem(this.data[i], i);
		}
	}
	
	this.createItem= function(item, index, parentId){
		var itemWrapper = createElementAndAppend("DIV",this.treeViewWrapper);
		var icon =  createElementAndAppend("IMG",itemWrapper);
		var span = createElementAndAppend("A",itemWrapper);
		var self =this;
		itemWrapper.id=parentId ? parentId + "["+index+"].sd" : "["+index+"].sd" ; //SALE !!!
		
		span.innerHTML = item.l;
		
		if(item.sd){
			icon.src = this.directorypath + "1ptrans.gif";
			icon.className="";
			icon.id = parentId ? parentId + "["+index+"].sd_IMG" : "["+index+"].sd_IMG";
			
			itemWrapper.onclick=function (){
				self.toggleDisplayBranch(this)
			};		
		}else{
			icon.src = this.directorypath + "1ptrans.gif";
			icon.className="";
			icon.id = parentId ? parentId + "["+index+"].sd_IMG" : "["+index+"].sd_IMG";
			
			itemWrapper.onclick=function(){self.itemOnclick(this);}
		}
		itemWrapper.appendChild(icon);
		itemWrapper.appendChild(span);
		return itemWrapper
	};
	this.toggleDisplayBranch = function(item){
		if(!item.nextSibling || item.nextSibling.className!='branch'){
			this.createBranch(item);
			return
		}
		if(item.nextSibling.style.display=="block"){
			item.nextSibling.style.display = "none";
			item.firstChild.className="";
		}else{
			item.nextSibling.style.display="block";
			item.firstChild.className="";
		}
	}
	
	this.createBranch = function(item){
		var itemLength;
		var branchDiv;
		if(item){
			var branchDiv =document.createElement("DIV");
			branchDiv.className= "branch";

			var branchItems = eval("this.data" + item.id); //SALE !!!
			var branchItemLength = branchItems.length;
			for (var i = 0; i< branchItemLength; i++){
				var itemCreated=this.createItem(branchItems[i], i, item.id);
				branchDiv.appendChild(itemCreated);
			};
			if (item.nextSibling){
				item.parentNode.insertBefore(branchDiv, item.nextSibling);
			}
			else{
				item.parentNode.appendChild(branchDiv);
			}
		}else{
			itemLength = this.items.length;
			for (var i = 0; i< itemLength; i++){
				var itemCreated=this.createItem(this.items[i], i);
				this.treeview.appendChild(itemCreated);
			}
		}
		
		item.nextSibling.style.position="inherit";
		item.nextSibling.style.display="block";
		item.nextSibling.style.paddingLeft=25 + "px";
	}
	
	
	this.init();
}


/*test héritage bidon*/

function treeView(targetId,data){
	BaseTreeView.apply(this,[targetId,data]);
	this.itemOnclick = function(item){
	if(this.selectedItem){
			this.selectedItem.children[1].style.background="";
		}
		this.selectedItem = item;
		this.selectedItem.children[1].style.background="blue";
}
}



function treeView2(targetId,data){
	treeView.apply(this,[targetId,data]);
	var self = this;

	/*TEST 
	A voir pour récupérer le super....
	
	self.itemOnclick
	
	*/
	var SuperItemOnclick = this.itemOnclick;
	
	this.itemOnclick = function(item){
		SuperItemOnclick(item);
		alert(self.data);
	}
}



window.onload = function(){
	var treeviewData =[{l:'Plan-Programme-Projet - Invite',sd:[{l:'Plan UNICA (vue courante)',sd:[{l:'AMT_test'},{l:'RB_TEST_PLAN'},{l:'Banque des Services'},{l:'Banque Conseil'},{l:'Plan de reprise des motifs de contacts'},{l:'Banque des Entreprises'},{l:'Plan Evènement Informatif'},{l:'Plan tests des canaux'},{l:'PLAN 2014'},{l:'Plan tous marhés'},{l:'PLANS PROGRAMMES RELATIONNELS'},{l:'Préconisarions batch'},{l:'Optimisation PNB cartes'}]}]},
	{l:'Plan-Programme-Projet - Invite',sd:[{l:'Plan UNICA (vue courante)',sd:[{l:'AMT_test'},{l:'RB_eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeTEST_PLAN'},{l:'Banque des Services'},{l:'Banque Conseil'},{l:'Plan de reprise des motifs de contacts'},{l:'Banque des Entreprises'},{l:'Plan Evènement Informatif'},{l:'Plan tests des canaux'},{l:'PLAN 2014'},{l:'Plan tous marhés'},{l:'PLANS PROGRAMMES RELATIONNELS'},{l:'Préconisarions batch'},{l:'Optimisation PNB cartes'}]}]}];	
	var tv1 = new treeView('treeview_test',treeviewData);
	var tv2 = new treeView2('treeview_test',treeviewData);
	

}
</SCRIPT>
<style>
#treeview_test{
width:500px;
height:500px;
background:red;
overflow:auto;
}
</style>
</head>
<body>
<div id='treeview_test'></div>

</body>
</html>

